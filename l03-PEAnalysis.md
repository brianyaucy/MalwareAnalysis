# Lab 03 - Analyzing PE File Structures

- [Lab 03 - Analyzing PE File Structures](#lab-03---analyzing-pe-file-structures)
  - [Scenario](#scenario)
  - [Tools](#tools)
  - [Task 1: Analyzing PE Headers](#task-1-analyzing-pe-headers)

---

## Scenario

You havebeen called by a client to examine a sample that their IR team collected from one of their systemsin the human resourcenetwork.

Sample:

- Lab_02.zip (password = `infected`)

<br/>

The goals of this lab areto get comfortable analyzing a Windows Portable Executable (PE) sample and providing initial knowledge about the sample and its capabilities.This information will aid in building IOCs later.

<br/>

192.168.210.10 / AdminELS / Nu3pmkfyX

---

## Tools

- CFF Explorer
- PEStudio
- PEView
- DependencyWalker
- Resource Hacker

<br/>

---

## Task 1: Analyzing PE Headers

**Question**

Analyzethe DOS, NT, File,and Optional Headers of the sample given and make sure you provide details that could help answer questions similar tothe following:

1. What are the file signatures and magic values?
2. What machine is this sample complied to be used on?
3. What was the date and time when this file was compiled?
4. How many sections does this file have?
5. Where will this sample be loaded in memory?
6. What is the minimum Windows version required to run the sample?
7. Is this ita console or GUI programand where could this be found?
8. Is this an executable of a DLL? (reminder: both are PE files,but one flag is difference)
9. Is the sample DEP and Terminal Server Aware?
10. What is the address of the first instruction that will be executed once the  file is started?
11. What section is the address pointing to?
12. What are the alignment settings for this sample?
13. How much memory space is required for this sample?

<br/>

**Answer**

**1 - File Signature and Magic value**

Open the file `Lab_02.exe` using **CFF Explorer**:

![](Images/2021-05-25-02-22-08.png)

- As shown in the **Dos Header**, the Magic Value is `0x5A4D` (`MZ`).
- This is a signature of an EXE file

<br>

**2 - What machine is this sample complied to be used on?**

The related information can be found in the **File Header**:

![](Images/2021-05-25-02-25-19.png)

- The value of the field `Machine` is `0x14C`, which refers to `Intel 386` machine type.
- Also this indicates it is a 32-bit application.

<br/>

**3 - What was the date and time when this file was compiled?**

The datetime of compiled can be found also in the **File Header**:

![](Images/2021-05-25-02-29-53.png)

- The `TimeDateStamp` is `0x5DF51884` (=`1576343684`)
- Then use **[EpochConverter](https://www.epochconverter.com/)** to convert the time to human-readable time:

![](Images/2021-05-25-02-33-16.png)

- The compile time is `Saturday, 14 December 2019 17:14:44 GMT`

<br/>

**4 - How many sections does this file have?**

We can find the value of `NumberOfSections` in the **File Header**:

![](Images/2021-05-25-02-36-21.png)

- `NumberOfSections` = `0x0008`, which means the PE file has 8 sections.

<br/>

**5 - Where will this sample be loaded in memory?**

