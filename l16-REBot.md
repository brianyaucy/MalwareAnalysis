# Lab 16 - Reverse Engineering a BOT using IDA Pro

- [Lab 16 - Reverse Engineering a BOT using IDA Pro](#lab-16---reverse-engineering-a-bot-using-ida-pro)
  - [Scenario](#scenario)
  - [Goal](#goal)
  - [Tools](#tools)
  - [Task 1: Main Sample Information](#task-1-main-sample-information)
  - [Task 2: Static analysis using IDA Pro](#task-2-static-analysis-using-ida-pro)
  - [Task 3: Sample IOCs](#task-3-sample-iocs)
  - [Task 4: Dynamic Analysis](#task-4-dynamic-analysis)

---

## Scenario

You have been called by a client to examine a weird sample that was collected from one of their systems. The system was seen by the network security engineers connecting to a weird remote location. The client thinks this sample could be hiding its true nature of activity.

<br/>

---

## Goal

The goal of this lab is to continue using pestudio for basic analysis and then understand how to reverse engineer a bot sample using IDA Pro and find the true nature of the sample.

<br/>

---

## Tools

- IDA Pro
- PeStudio

<br/>

---

## Task 1: Main Sample Information

Analyze the sample using basic static analysis methods to find and collect as much information as you can to help during the reverse engineering (advanced static analysis) process.

<br/>

**Answer**

Load `Bot_Sample.exe` into **PeStudio**.

![picture 294](images/c9676e77b92dc2206f7fb1aa9a69991d1592d13c80e8cb97c272977b81d6f0a6.png)  

- Hashes
  - md5,5FB3F68ABDEA5FB5489495004440A58D
  - sha1,70393702494F1C189E03648406E9DBFD9B5F38D4
  - sha256,DB48EEF68E1CC667132BA32B0AA6B79F4B1E6EDDE4D131CB8E56BDF945314058
- Type: Windows PE
- 32-bit

<br/>

Check the indicator:

![picture 295](images/d0a4a3cf0caa6bde6caa12be69993e99639478fb702cff12d2a6080f73d370bf.png)  

- Potential network IOC `46.101.26.241`
- Compiled time is weird

<br/>

Check the libraries:

![picture 296](images/b98196f13f125f5fd8f52a46729b6faf326c4f24e2548a1ceba6c91af5ff34b7.png)  

- `urlmon.dll` - Provide network connectivity (e.g. URLDownloadToFile)
- `iphlpapi.dll` - IPv6
- `ws2_32.dll` - Windows Socket related

<br/>

Check the imports:

![picture 297](images/f36c419441500e9390fc28cbca23334efff6830e9d2311b71bff84e79899f6f6.png)  

- Many network API imports

<br/>

Check the strings:

![picture 298](images/a03dca18ede130f3e287ab13b29738b37d00e2977215318b1f910165819b6dda.png)  

![picture 299](images/26d19af9a4c97caff1f4e375401dc327cb744cc9d9d8bef579d87ac03334d7b5.png)  

- `icmp_flood` / `http_flood` / `download` looks like some sorts of commands

<br/>

---

## Task 2: Static analysis using IDA Pro

Reverse engineer the collected sample to understand its true nature.

<br/>

**Answer**

Load the sample on **IDA**.

Let's check the API call `URLDownloadToFileA`. Navigate to `Imports tab` and type `URLDownloadToFileA`:

![picture 300](images/0f15351537726714675ddea62216ec25630d015d1fac0bebb964a20dde24b5ee.png)  

- Double click > Click the API again > Hit `X`

![picture 301](images/ad008f7a8669e905042e3e888ab2b741c5ff5cdebba617413bbc5188d3655273.png)  

- Click `OK` to jump to the code calling this API

<br/>

Before analyzing further, click on the subroutine `sub_401188` and hit `X` to check which part of the code invokes `URLDownloadToFileA`:

![picture 302](images/d42c2201d57e71260ef88daacf85d4ff1d62801321d6dbee3ae3da61bb4e6c29.png)  

<br/>

![picture 304](images/e5f6d71ca68daf4bd5897fac6249d473b7a55037a381b275d3397f18400cfc04.png)  

- `loc_4015F0`

![picture 1](images/215b43c02d9ae14c46e187a39a7220f492a70a22ba48e0294d7dd28402dda178.png)  


<br/>

---

## Task 3: Sample IOCs

Determine the IOCs that could be created to find and identify this sample on other systems.

<br/>

**Answer**

<br/>

---

## Task 4: Dynamic Analysis

Run the sample and provide an explanation of what the sample does.

<br/>

**Answer**

<br/>

---