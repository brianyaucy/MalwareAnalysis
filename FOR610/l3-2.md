# Lab 3.2: Deobfuscating session.html using the Internet Explorer Debugger

- [Lab 3.2: Deobfuscating session.html using the Internet Explorer Debugger](#lab-32-deobfuscating-sessionhtml-using-the-internet-explorer-debugger)
  - [Objectives](#objectives)
  - [Steps](#steps)
  - [1,2 - Examine session.html on Notepad++](#12---examine-sessionhtml-on-notepad)
  - [3 - Revert the script on Notepad++](#3---revert-the-script-on-notepad)
  - [4,5 - Add the debugger statement and save](#45---add-the-debugger-statement-and-save)
  - [6 - Load session.html and bring up Developer Tools](#6---load-sessionhtml-and-bring-up-developer-tools)
  - [7 - Reload session.html and allow blocked content](#7---reload-sessionhtml-and-allow-blocked-content)
  - [8 - Insert a breakpoint in front of the `return r` statement](#8---insert-a-breakpoint-in-front-of-the-return-r-statement)
  - [9,10 - Execute the script and examine the content of variable r](#910---execute-the-script-and-examine-the-content-of-variable-r)
  - [11 - Beautify the script](#11---beautify-the-script)

---

## Objectives

- Understand the essential aspects of JavaScript deobfuscation.
- Learn how to use the Internet Explorer debugger to deobfuscate JavaScript.

<br/>

---

## Steps

1. Load `session.html` in **Notepad++** on the Windows REM Workstation and beautify the script.
2. Examine the script to locate the statement where you might want to set a breakpoint.
3. Revert the script to eliminate the errors introduced by the beautification process.
4. Add the debugger; statement in the beginning of the second set of script tags.
5. Save the modified `session.html` file and minimize Notepad++.
6. Load `session.html` in Internet Explorer and bring up Developer Tools.
7. Reload `session.html` in Internet Explorer and click `Allow blocked content`.
8. Insert a breakpoint in front of the return `r` statement.
9. Execute the script, allowing it to reach the breakpoint.
10. Examine the contents of variable `r`.
11. Paste the deobfuscated script to a new **Notepad++** tab and beautify it.

<br/>

--

## 1,2 - Examine session.html on Notepad++

First open `session.html` on **Notepad++**, and use `Plugins > JSTool > JSFormat`:

![picture 211](../images/17ca62d4618897e125aec592238915bb22f8b3accdcdd09ad4ca75d9ea14e224.png)  

<br/>

![picture 212](../images/05e512062d5c03c28cc50329e32b39db06dc0304bc4fee530626a405d8f6855c.png)  

- Set a breakpoint at the `return r` statement for inspecting the deobfuscated result

<br/>

---

## 3 - Revert the script on Notepad++

To revert, click `File > Reload from Disk`:

![picture 213](../images/a57bcd38877dbe010177066407130c363388b99b0f28a16f407a105db52dbdf3.png)  

<br/>

![picture 214](../images/7384c43731cef530450e3e619066ad925c3b7eef16172848b8279063cceacca7.png)  

- The file has been reverted

<br/>

---

## 4,5 - Add the debugger statement and save

![picture 215](../images/88c51f671be00e1713da32c8206a77ade0168c26a3e29b428850f4ac79a129e6.png)  

<br/>

---

## 6 - Load session.html and bring up Developer Tools

Double click the `session.html` file. You will see a prompt of `Blocked Content`. Before proceeding, hit `F12` to load the **Developer Tools**:

![picture 216](../images/9787d42eeb7b4b83bfff71fee243ffdb8bd382dccdf727e4f263b2c951bbc3ea.png)  

<br/>

---

## 7 - Reload session.html and allow blocked content

Click the `Refresh` button and Allowed the content:

![picture 217](../images/8cc32fd1d4e479e6034bccbd74eac8cf614abbc06245aef0d0ad2747a3b05c3e.png)  

<br/>

---

## 8 - Insert a breakpoint in front of the `return r` statement

Click the space between the `}` and the `r`. Right click and `Insert breakpoint`:

![picture 218](../images/10ba7225a3e5ab1bd8c23b8f8d2ecdaa44ca80437bd33b7604a373cfaf57702c.png)  

<br/>

---

## 9,10 - Execute the script and examine the content of variable r

Click the start button:

![picture 219](../images/7e518912306abf598414d4559e83e65aec8ebabee339785d2521ef4f7e99fbac.png)  

<br/>

![picture 220](../images/a5a08086f12383372db00a391f5e6f0a2002cd31e8a00ac8e4f4a417a74eb9b4.png)  

- The program stops at the breakpoint set

<br/>

Copy the value of `r`:

![picture 221](../images/43c89a7caca6bb95a4553a2a6290e73ef79ad920abe7cab20de54a7d480576f9.png)  

<br/>

Paste it on **Notepad++** for further investigation:

![picture 222](../images/e2c2acbf73b8377fdd950cd42b937e45a0bedc83c37318968bf58d9e9a5bfb46.png)  

- However, the double quote `"` are all escaped to be `\"`.

<br/>

Instead, we can use the browser console to get the value.

Select the **Console tab** and use the following command:

```
console.group(r)
```

![picture 223](../images/8f86e7d48aec05cf8f27e0dae324c6ebeea6050f86edcd17d7c7302118f4158b.png)  

<br/>

Then, right click on the line and choose `Copy item`:

![picture 224](../images/5794cf04a9f636265e757d0e9c46faa1935bc839b7655045599a773c810a45f5.png)  

<br/>

Paste it on **Notepad++**:

![picture 225](../images/6aa31842ed5de10d09b29e29fc3a4497867d2b73596406df304f643a77c17c69.png)  

<br/>

---

## 11 - Beautify the script

`Plugins > JSTools > JSFormat`:

![picture 226](../images/64a5d6269f7d82eb14cf89fa78c722bc315cfbf5e7eefbfbad34f0147f67209f.png)  

<br/>

