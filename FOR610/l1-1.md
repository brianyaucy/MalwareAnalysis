# Ex 1.1 - Static Properties Analysis of brbbot.exe

- [Ex 1.1 - Static Properties Analysis of brbbot.exe](#ex-11---static-properties-analysis-of-brbbotexe)
  - [Objectives](#objectives)
  - [Tasks 1: Strings](#tasks-1-strings)
    - [(REMnux) pestr](#remnux-pestr)
    - [(Windows) PeStudio](#windows-pestudio)
    - [(Windows) BinText](#windows-bintext)
  - [Task 2: Spot anomalous aspects](#task-2-spot-anomalous-aspects)
    - [(REMnux) peframe](#remnux-peframe)
    - [(REMnux) PEFrame](#remnux-peframe-1)
    - [(REMnux) pescanner](#remnux-pescanner)
    - [(Windows) PeStudio](#windows-pestudio-1)

---

## Objectives

- Learn how to perform an initial assessment of the suspicious Windows executable file.
- Experiment with tools and techniques for examining static properties of a specimen.

<br/>

---

## Tasks 1: Strings

**Task 1**

Extract ASCII and Unicode strings embedded into brbbot.exe.

<br/>

### (REMnux) pestr

We can use in `pestr` in REMnux:

```
pestr brbbot.exe | less
```

![picture 1](../images/ad3a958550f24b06c1470adb3be9a128b96380a320fe4fb22fa78114f20bec22.png)  

<br/>

### (Windows) PeStudio

We can also inspect the strings using **PeStudio**:

![picture 2](../images/84ef97fac46c45c4baf9c5038d2c1cfe3c7d4794082bfa00c4435e18e8eaa0c1.png) 

- Interesting strings:

```
ascii,13,-,x,-,-,brbconfig.tmp
ascii,45,-,x,-,-,Software\Microsoft\Windows\CurrentVersion\Run
ascii,63,-,x,-,-,Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0)
ascii,4,x,-,-,-,file
ascii,8,x,-,-,-,HTTP/1.1
ascii,6,-,-,-,-,CONFIG
ascii,8,-,-,-,-,YnJiYm90
ascii,4,-,-,-,-,exec
ascii,4,-,-,-,-,conf
ascii,4,-,-,-,-,exit
ascii,5,-,-,-,-,sleep
ascii,6,-,-,-,-,encode
ascii,4,-,-,-,-,%02x
ascii,17,-,-,-,-,%s?i=%s&c=%s&p=%s
ascii,6,-,-,-,-,APPDAT
ascii,6,-,-,-,-,brbbot
```


### (Windows) BinText

Launch **BinText** and change the filter to include strings >=10 characters:

![picture 3](../images/f418428eaee1f72c61b4b5d602c04cc44c5074e1556c5ab6fbf33f5bd527f561.png)  

<br/>

Then scan the sample:

![picture 4](../images/a220f6c727f2ad7788653737a11df3b2daae8a98ad92b36a28b1149f7677a252.png)  

<br/>

---

## Task 2: Spot anomalous aspects

**Task**

Spot anomalous aspects of brbbot.exe.

<br/>

### (REMnux) peframe

Use `peframe` to examine:

```
peframe brbbot.exe
```

- Result:

```
Short information
------------------------------------------------------------
File Name          brbbot.exe
File Size          75776 byte
Compile Time       2015-02-25 01:12:18
DLL                False
Sections           6
Hash MD5           1c7243c8f3586b799a5f9a2e4200aa92
Hash SHA-1         4db5a8e237937b6d7b435a8506b8584121a7e9e3
Imphash            475b069fec5e5868caeb7d4d89236c89
Detected           Packer, Anti Debug
Directory          Import, Resource, Relocation

Packer matched [1]
------------------------------------------------------------
Packer             Microsoft Visual C++ 8.0 (DLL)

Anti Debug discovered [4]
------------------------------------------------------------
Function           GetLastError
Function           IsDebuggerPresent
Function           TerminateProcess
Function           UnhandledExceptionFilter

Suspicious API discovered [44]
------------------------------------------------------------
Function           CloseHandle
Function           CopyFileA
Function           CreateFileA
Function           CreateFileW
Function           CreateProcessA
Function           CryptEncrypt
Function           DeleteFileA
Function           ExitProcess
Function           FindResourceA
Function           GetCommandLineW
Function           GetComputerNameA
Function           GetCurrentProcess
Function           GetCurrentProcessId
Function           GetFileSize
Function           GetModuleFileNameA
Function           GetModuleFileNameW
Function           GetModuleHandleA
Function           GetModuleHandleW
Function           GetProcAddress
Function           GetStartupInfoW
Function           GetSystemDirectoryA
Function           GetTempFileNameA
Function           GetTempPathA
Function           GetTickCount
Function           HttpQueryInfoA
Function           HttpSendRequestA
Function           InternetCloseHandle
Function           InternetConnectA
Function           InternetOpenA
Function           InternetQueryDataAvailable
Function           InternetReadFile
Function           IsDebuggerPresent
Function           LoadLibraryW
Function           LockResource
Function           ReadFile
Function           RegCloseKey
Function           RegDeleteValueA
Function           RegOpenKeyExA
Function           SetFilePointer
Function           Sleep
Function           TerminateProcess
Function           UnhandledExceptionFilter
Function           WSAStartup
Function           WriteFile

File name discovered [7]
------------------------------------------------------------
Temporary          brbconfig.tmp
Library            ADVAPI32.dll
Library            KERNEL32.dll
Library            USER32.dll
Library            WININET.dll
Library            WS2_32.dll
Library            ntdll.dll
```



<br/>

### (REMnux) PEFrame

```
peframe brbbot.exe
```

- Result:

```
Short information
------------------------------------------------------------
File Name          brbbot.exe
File Size          75776 byte
Compile Time       2015-02-25 01:12:18
DLL                False
Sections           6
Hash MD5           1c7243c8f3586b799a5f9a2e4200aa92
Hash SHA-1         4db5a8e237937b6d7b435a8506b8584121a7e9e3
Imphash            475b069fec5e5868caeb7d4d89236c89
Detected           Packer, Anti Debug
Directory          Import, Resource, Relocation

Packer matched [1]
------------------------------------------------------------
Packer             Microsoft Visual C++ 8.0 (DLL)

Anti Debug discovered [4]
------------------------------------------------------------
Function           GetLastError
Function           IsDebuggerPresent
Function           TerminateProcess
Function           UnhandledExceptionFilter

Suspicious API discovered [44]
------------------------------------------------------------
Function           CloseHandle
Function           CopyFileA
Function           CreateFileA
Function           CreateFileW
Function           CreateProcessA
Function           CryptEncrypt
Function           DeleteFileA
Function           ExitProcess
Function           FindResourceA
Function           GetCommandLineW
Function           GetComputerNameA
Function           GetCurrentProcess
Function           GetCurrentProcessId
Function           GetFileSize
Function           GetModuleFileNameA
Function           GetModuleFileNameW
Function           GetModuleHandleA
Function           GetModuleHandleW
Function           GetProcAddress
Function           GetStartupInfoW
Function           GetSystemDirectoryA
Function           GetTempFileNameA
Function           GetTempPathA
Function           GetTickCount
Function           HttpQueryInfoA
Function           HttpSendRequestA
Function           InternetCloseHandle
Function           InternetConnectA
Function           InternetOpenA
Function           InternetQueryDataAvailable
Function           InternetReadFile
Function           IsDebuggerPresent
Function           LoadLibraryW
Function           LockResource
Function           ReadFile
Function           RegCloseKey
Function           RegDeleteValueA
Function           RegOpenKeyExA
Function           SetFilePointer
Function           Sleep
Function           TerminateProcess
Function           UnhandledExceptionFilter
Function           WSAStartup
Function           WriteFile

File name discovered [7]
------------------------------------------------------------
Temporary          brbconfig.tmp
Library            ADVAPI32.dll
Library            KERNEL32.dll
Library            USER32.dll
Library            WININET.dll
Library            WS2_32.dll
Library            ntdll.dll

```

<br/>

### (REMnux) pescanner

```
pescanner brbbot.exe
```

- Result:

```
##########################################################################################
[0] File: brbbot.exe
##########################################################################################

Meta-data
==========================================================================================
Size		: 75776 bytes
Type		: PE32+ executable (GUI) x86-64, for MS Windows
Architecture	: 64 Bits binary
MD5		: 1c7243c8f3586b799a5f9a2e4200aa92
SHA1		: 4db5a8e237937b6d7b435a8506b8584121a7e9e3
ssdeep		: 1536:b6sMD3H8V3jsUnHLiREsTbDV/48OO4vh47483gLi9+LSG:b6srVzJiRrTHVORe75g4+LS
imphash		: 475b069fec5e5868caeb7d4d89236c89
Date		: 0x54ED67C2 [Wed Feb 25 06:12:18 2015 UTC]
Language	: ENGLISH
CRC:	(Claimed) : 0x0, (Actual): 0x159b5 [SUSPICIOUS]
Entry Point	: 0x140003f94 .text 0/6
================
Offset | Instructions
----------------------------------------
0	dec eax
1	sub esp,0x28
4	call 0x40008994
9	dec eax
10	add esp,0x28
13	jmp 0x40003df8
18	int3 
19	int3 
20	dec eax
21	mov [esp+0x8],ecx
25	dec eax
26	sub esp,0x88
32	dec eax
33	lea ecx,[0xf505]
39	call [0xa257]
45	dec eax
46	mov eax,[0xf5f0]
52	dec eax
53	mov [esp+0x58],eax
57	inc ebp
58	xor eax,eax
60	dec eax
61	lea edx,[esp+0x60]
65	dec eax
66	mov ecx,[esp+0x58]
70	call 0x4000d092
75	dec eax
76	mov [esp+0x50],eax
80	dec eax
81	cmp dword [esp+0x50],0x0
86	jz 0x4000402d
88	dec eax
89	mov dword [esp+0x38],0x0
97	dec eax
98	lea eax,[eax+eax+0x0]

Sections
==========================================================================================
Name       VirtAddr     VirtSize     RawSize    MD5                              Entropy
------------------------------------------------------------------------------------------
.text      0x1000       0xc29f       0xc400     bbd3af727b760f43f79949ed12967f15 6.349488    
.rdata     0xe000       0x385a       0x3a00     17f740269d4d7b5a4dba2dcf5f974db6 4.760346    
.data      0x12000      0x3d00       0x1400     2e35bbdf7154182a22115a6f25bfa771 1.972888    
.pdata     0x16000      0xb04        0xc00      41d59b361c2388908534d43ad9beeafc 4.504661    
.rsrc      0x17000      0xc0         0x200      60dbb5e97fab0b4434173e100d16967c 1.867957    
.reloc     0x18000      0x306        0x400      839270e9b89f3de10367cb764b52800f 2.555020    

Resource entries
==========================================================================================
Resource type      Total   
-------------------------
CONFIG             : 1       

Imports
==========================================================================================
[1] ADVAPI32.dll
[2] WININET.dll
[3] WS2_32.dll
[4] KERNEL32.dll
[5] USER32.dll

Suspicious IAT alerts
==========================================================================================
[1] CopyFileA
[2] CreateFileA
[3] CreateFileW
[4] CreateProcessA
[5] CryptEncrypt
[6] DeleteFileA
[7] FindResourceA
[8] GetCommandLineW
[9] GetComputerNameA
[10] GetFileSize
[11] GetModuleFileNameA
[12] GetModuleFileNameW
[13] GetModuleHandleA
[14] GetModuleHandleW
[15] GetProcAddress
[16] GetStartupInfoW
[17] GetTempFileNameA
[18] GetTempPathA
[19] GetTickCount
[20] HttpQueryInfoA
[21] HttpSendRequestA
[22] InternetCloseHandle
[23] InternetConnectA
[24] InternetOpenA
[25] InternetQueryDataAvailable
[26] InternetReadFile
[27] IsDebuggerPresent
[28] LoadLibraryW
[29] LockResource
[30] RegCloseKey
[31] RegDeleteValueA
[32] RegOpenKeyExA
[33] Sleep
[34] TerminateProcess
[35] UnhandledExceptionFilter
[36] WSAStartup
[37] WriteFile

```


<br/>

### (Windows) PeStudio

![picture 5](../images/9d9c38b908a09af76cd449036b52edd14a0080526e262b5e631a711f49105495.png)  

File hash:

- md5,1C7243C8F3586B799A5F9A2E4200AA92
- sha1,4DB5A8E237937B6D7B435A8506B8584121A7E9E3
- sha256,F47060D0F7DE5EE651878EB18DD2D24B5003BDB03EF4F49879F448F05034A21E

<br/>

![picture 6](../images/ced00f7bd617c650d79d659be5427608915ddc1efc8f4723ae6d0e07ad1f0277.png)  

- `wininet.dll` / `ws2_32.dll` - Potential network connection capabilities

<br/>

![picture 8](../images/652d04a9687787a1bb30f940941effda63558f8dc242c87540d85d1fadf0f1f1.png)  

- `LoadLibraryW` - Load additional DLLs during runtime
- `RegSetValueExA` - Set registry value
- `CryptDeriveKey` - The use of Windows crypto capabilities

<br/>

In summary, from the Static Analysis, we generate the following hypothesis:

- The following could be used as IOCs:
  - `brbconfig.tmp` exists in the file system
  - HTTP request pattern `%s?i=%s&c=%s&p=%s`
- Potential persistence capability using registry key `..\Windows\CurrentVersion\Run`
- Network communication mechanism:
  - `Network: HTTP/1.1`
  - `User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0)`

<br/>

---