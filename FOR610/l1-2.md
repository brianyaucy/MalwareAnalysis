# Ex 1.2: Initial Behavioral Analysis of brbbot.exe

- [Ex 1.2: Initial Behavioral Analysis of brbbot.exe](#ex-12-initial-behavioral-analysis-of-brbbotexe)
  - [Objective](#objective)
  - [Exercise steps](#exercise-steps)
  - [1 - Preparations 1 - Process hacker and Process Monitor](#1---preparations-1---process-hacker-and-process-monitor)
  - [2 - Regshot](#2---regshot)
  - [3 - Preparation 2 - Wireshark](#3---preparation-2---wireshark)
  - [4 - Activate Procmon and run the sample](#4---activate-procmon-and-run-the-sample)
  - [5,6 - Stop brbbot.exe and monitors](#56---stop-brbbotexe-and-monitors)
  - [7 - Regshot 2nd shot](#7---regshot-2nd-shot)
  - [8 - Analyze Process Monitor's log file using ProcDOT](#8---analyze-process-monitors-log-file-using-procdot)
  - [9 - Examine Wireshark events](#9---examine-wireshark-events)
  - [References](#references)

---

## Objective

- Understand the essential aspects of behavioral analysis of malicious Windows programs.
- Understand the role and usage nuances of key behavioral analysis tools

<br/>

---

## Exercise steps

1. Launch Process Hacker and Process Monitor on Windows REM Workstation.
2. Launch Regshot and take the first snapshot using this tool on Windows REM
Workstation.
3. Launch Wireshark on REMnux and start its capture.
4. Activate monitoring in Process Monitor and infect Windows REM Workstation with brbbot.exe.
5. Terminate the brbbot.exe process and stop capture in Process Monitor.
6. Stop capture in Wireshark.
7. Take the second Regshot snapshot and compare it to the first one, examining Regshot's report.
8. Analyze Process Monitor's log file using ProcDOT.
9. Examine Wireshark's log file

<br/>

---

## 1 - Preparations 1 - Process hacker and Process Monitor

Launch **Process Hacker** and **Process Monitor** on the Windows machine first. 

Before running **Regshot**, pause capturing process and clear the logs on **Process Monitor** so as to prevent noise.

![picture 9](../images/c0d42fd7a6d00700623cb6338fba1908777c657a12cc237f845185e1f2032795.png)  

<br/>

## 2 - Regshot

Run Regshot 1st Shot (`Shot`), with `Scan dir` configured as `C:\`

![picture 10](../images/badd4d2bbdb9a1463946f97a6defa0ebf0b249bfdb538dbfa17a487d8a7d68c3.png)  

<br/>

## 3 - Preparation 2 - Wireshark

On **REMnux**, run **Wireshark** to capture the traffic on `eth0`:

```
wireshark &
```

![picture 11](../images/0617a6444935bb2acff2a5c45aa51c1a9a4aaf70f7aee19840569880b244e35e.png)  

<br/>

## 4 - Activate Procmon and run the sample

Activate **Procmon**:

![picture 12](../images/b8f9bbe92c7ab12d3598d2b97be15e1509a8cc822614b410a351bbcca345379c.png)  

<br/>

## 5,6 - Stop brbbot.exe and monitors

After a while, terminate the `brbbot.exe` process in `Process Hacker`:

![picture 13](../images/ffa23616732989f5b5756f79e1bf1c5e909b3b5f269f9303cf6be99748a606a4.png)  

<br/>

Then deactivate **Procmon** and **Wireshark**.

<br/>

## 7 - Regshot 2nd shot

Capture the 2nd shot and compare the result:

![picture 14](../images/633c1d8c6ba6bef1eeadb434c0e701fa8765e58c89bdc9edd7e2caedd8fd74bf.png)  

![picture 15](../images/283bd87ac9d25b12cd8de17af689aeec610b3cbbeed72dfdabd5c56cdd575e6b.png)  

<br/>

Here is the report:

```
Regshot 1.9.0 x64 ANSI
Comments: 
Datetime: 2021/7/6 02:44:15  ,  2021/7/6 02:58:52
Computer: DESKTOP-2C3IQHO , DESKTOP-2C3IQHO
Username: REM , REM

----------------------------------
Keys added: 5
----------------------------------
HKU\S-1-5-21-1866265027-1870850910-1579135973-1000\Software\Microsoft\Windows\CurrentVersion\Explorer\SessionInfo\1\ApplicationViewManagement\W32:0000000000050482
HKU\S-1-5-21-1866265027-1870850910-1579135973-1000\Software\Microsoft\Windows\CurrentVersion\Explorer\SessionInfo\1\ApplicationViewManagement\W32:000000000007044C
HKU\S-1-5-21-1866265027-1870850910-1579135973-1000\Software\Microsoft\Windows\CurrentVersion\Explorer\SessionInfo\1\ApplicationViewManagement\W32:00000000000A044A
HKU\S-1-5-21-1866265027-1870850910-1579135973-1000\Software\Microsoft\Windows\CurrentVersion\Explorer\SessionInfo\1\ApplicationViewManagement\W32:000000000012044A
HKU\S-1-5-21-1866265027-1870850910-1579135973-1000\Software\Microsoft\Windows\CurrentVersion\Explorer\SessionInfo\1\ApplicationViewManagement\W32:00000000001504AE

----------------------------------
Values added: 9
----------------------------------
HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\brbbot: "C:\Users\REM\AppData\Roaming\brbbot.exe"
HKLM\SYSTEM\ControlSet001\Control\Session Manager\PendingFileRenameOperations:  5C 3F 3F 5C 43 3A 5C 55 73 65 72 73 5C 52 45 4D 5C 41 70 70 44 61 74 61 5C 52 6F 61 6D 69 6E 67 5C 62 72 62 63 6F 6E 66 69 67 2E 74 6D 70 00 00 5C 3F 3F 5C 43 3A 5C 55 73 65 72 73 5C 52 45 4D 5C 41 70 70 44 61 74 61 5C 52 6F 61 6D 69 6E 67 5C 62 72 62 63 6F 6E 66 69 67 2E 74 6D 70 00 00 5C 3F 3F 5C 43 3A 5C 55 73 65 72 73 5C 52 45 4D 5C 41 70 70 44 61 74 61 5C 52 6F 61 6D 69 6E 67 5C 62 72 62 63 6F 6E 66 69 67 2E 74 6D 70 00 00 00
HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\PendingFileRenameOperations:  5C 3F 3F 5C 43 3A 5C 55 73 65 72 73 5C 52 45 4D 5C 41 70 70 44 61 74 61 5C 52 6F 61 6D 69 6E 67 5C 62 72 62 63 6F 6E 66 69 67 2E 74 6D 70 00 00 5C 3F 3F 5C 43 3A 5C 55 73 65 72 73 5C 52 45 4D 5C 41 70 70 44 61 74 61 5C 52 6F 61 6D 69 6E 67 5C 62 72 62 63 6F 6E 66 69 67 2E 74 6D 70 00 00 5C 3F 3F 5C 43 3A 5C 55 73 65 72 73 5C 52 45 4D 5C 41 70 70 44 61 74 61 5C 52 6F 61 6D 69 6E 67 5C 62 72 62 63 6F 6E 66 69 67 2E 74 6D 70 00 00 00
HKU\S-1-5-21-1866265027-1870850910-1579135973-1000\Software\Microsoft\Windows\CurrentVersion\Explorer\SessionInfo\1\ApplicationViewManagement\W32:0000000000050482\VirtualDesktop:  10 00 00 00 30 30 44 56 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
HKU\S-1-5-21-1866265027-1870850910-1579135973-1000\Software\Microsoft\Windows\CurrentVersion\Explorer\SessionInfo\1\ApplicationViewManagement\W32:000000000007044C\VirtualDesktop:  10 00 00 00 30 30 44 56 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
HKU\S-1-5-21-1866265027-1870850910-1579135973-1000\Software\Microsoft\Windows\CurrentVersion\Explorer\SessionInfo\1\ApplicationViewManagement\W32:00000000000A044A\VirtualDesktop:  10 00 00 00 30 30 44 56 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
HKU\S-1-5-21-1866265027-1870850910-1579135973-1000\Software\Microsoft\Windows\CurrentVersion\Explorer\SessionInfo\1\ApplicationViewManagement\W32:000000000012044A\VirtualDesktop:  10 00 00 00 30 30 44 56 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
HKU\S-1-5-21-1866265027-1870850910-1579135973-1000\Software\Microsoft\Windows\CurrentVersion\Explorer\SessionInfo\1\ApplicationViewManagement\W32:00000000001504AE\VirtualDesktop:  10 00 00 00 30 30 44 56 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
HKU\S-1-5-21-1866265027-1870850910-1579135973-1000\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Compatibility Assistant\Store\C:\Users\REM\AppData\Roaming\brbbot.exe:  53 41 43 50 01 00 00 00 00 00 00 00 07 00 00 00 28 00 00 00 00 28 01 00 00 00 00 00 01 00 00 00 00 00 00 00 00 00 00 0A 73 20 00 00 DB 80 FD AC 28 39 D3 01 00 00 00 00 00 00 00 00 02 00 00 00 28 00 00 00 00 00 00 00 00 00 00 40 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 C5 44 01 00 00 00 00 00 03 00 00 00 03 00 00 00

----------------------------------
Values modified: 6
----------------------------------
HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Diagnostics\DiagTrack\SettingsRequests\LastDownloadTime:  08 50 35 AC 0F 72 D7 01
HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Diagnostics\DiagTrack\SettingsRequests\LastDownloadTime:  40 A5 20 CA 11 72 D7 01
HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Notifications\Data\418A073AA3BC3475:  96 07 00 00 00 00 00 00 04 00 04 00 01 02 05 00 00 00 00 00 47 00 00 00 0D 78 79 00 01 00 00 00 6B 50 7E 00 04 00 00 00 87 DE 83 00 5F 00 00 00 A1 9F 5E 00 01 00 00 00 DA D8 7E 00 04 00 01 00 00 00 2D 00 00 00 56 73 7D 00 05 00 00 00 6B 50 7E 00 01 00 00 00 98 29 B7 00 05 00 00 00 E6 C5 31 00 01 00 04 00 00 00 11 00 00 00 1A 9C B2 00 02 00 65 00 00 00 04 00 00 00 A2 05 06 00 36 18 00 00 E6 C5 31 00 01 00 67 00 00 00 04 00 00 00 A2 05 06 00 01 00 68 00 00 00 02 00 00 00 A2 05 06 00
HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Notifications\Data\418A073AA3BC3475:  98 07 00 00 00 00 00 00 04 00 04 00 01 02 05 00 00 00 00 00 47 00 00 00 0D 78 79 00 01 00 00 00 6B 50 7E 00 04 00 00 00 87 DE 83 00 5F 00 00 00 A1 9F 5E 00 01 00 00 00 DA D8 7E 00 04 00 01 00 00 00 33 00 00 00 56 73 7D 00 05 00 00 00 6B 50 7E 00 01 00 00 00 98 29 B7 00 05 00 00 00 E6 C5 31 00 01 00 04 00 00 00 11 00 00 00 1A 9C B2 00 02 00 65 00 00 00 04 00 00 00 A2 05 06 00 36 18 00 00 E6 C5 31 00 01 00 67 00 00 00 04 00 00 00 A2 05 06 00 01 00 68 00 00 00 02 00 00 00 A2 05 06 00
HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks\{D80AA3A2-189B-4A11-8828-511E6BAE5426}\Hash:  A2 1C AA 7A 83 82 8D 56 DC 5F 48 BD 8B 57 F8 6B 63 1A E1 FB 02 1A F8 F8 E9 1B B0 F1 79 A0 55 A1
HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks\{D80AA3A2-189B-4A11-8828-511E6BAE5426}\Hash:  19 50 44 28 90 0C 7A C9 DE 9F AD 60 86 6F 98 95 6A BE C1 74 6B FD B9 BB 3C 9A E9 79 2D E4 83 CC
HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks\{D80AA3A2-189B-4A11-8828-511E6BAE5426}\Triggers:  17 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 FF FF FF FF FF FF FF FF D0 21 42 43 48 48 48 48 F7 D8 97 26 48 48 48 48 18 00 00 00 48 48 48 48 4C 00 6F 00 63 00 61 00 6C 00 53 00 79 00 73 00 74 00 65 00 6D 00 00 00 00 00 00 00 48 48 48 48 00 48 48 48 48 48 48 48 00 48 48 48 48 48 48 48 05 00 00 00 48 48 48 48 0C 00 00 00 48 48 48 48 01 01 00 00 00 00 00 05 12 00 00 00 48 48 48 48 00 00 00 00 48 48 48 48 2C 00 00 00 48 48 48 48 00 00 00 00 FF FF FF FF 40 38 00 00 FF FF FF FF 07 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 48 48 48 48 FF FF 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 FF FF FF FF FF FF FF FF B4 00 00 00 FF FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00 00 7F 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 32 00 00 00
 51 00 75 00 65 00 75 00 65 00 52 00 65 00 70 00 6F 00 72 00 74 00 69 00 6E 00 67 00 42 00 6F 00 6F 00 74 00 54 00 72 00 69 00 67 00 67 00 65 00 72 00 48 48 66 66 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 FF FF FF FF FF FF FF FF 00 00 00 00 FF FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00 00 7F 00 00 01 FF FF FF 01 00 00 00 01 00 00 00 00 00 00 00 30 00 00 00 51 00 75 00 65 00 75 00 65 00 52 00 65 00 70 00 6F 00 72 00 74 00 69 00 6E 00 67 00 57 00 6E 00 66 00 54 00 72 00 69 00 67 00 67 00 65 00 72 00 48 48 48 48 75 10 BC A3 3A 0B 94 41 01 00 00 00 00 00 00 00 01 66 66 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 FF FF FF FF FF FF FF FF 00 00 00 00 FF FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00 00 7F 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 40 00 00 00 51 00 75 00 65 00 75 00 65 00 52 00 65 00 70 00 6F 00 72 00 74 00 69 00 6E 00 67 00 46 00 72 00 65 00 65 00 4E 00 65 00 74 00 77 00 
6F 00 72 00 6B 00 54 00 72 00 69 00 67 00 67 00 65 00 72 00 48 48 48 48 75 10 BC A3 3E 0B 84 41 01 00 00 00 00 00 00 00 03 DD DD 00 00 00 00 00 00 00 07 07 00 00 00 06 00 80 74 07 6D 0F 72 D7 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 08 07 00 00 00 00 00 00 FF FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00 00 01 43 B7 01 00 00 00 08 07 00 00 8D EC 00 00 32 00 00 00 51 00 75 00 65 00 75 00 65 00 52 00 65 00 70 00 6F 00 72 00 74 00 69 00 6E 00 67 00 54 00 69 00 6D 00 65 00 54 00 72 00 69 00 67 00 67 00 65 00 72 00 48 48
HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks\{D80AA3A2-189B-4A11-8828-511E6BAE5426}\Triggers:  17 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 FF FF FF FF FF FF FF FF D0 21 42 43 48 48 48 48 7E FF 31 4E 48 48 48 48 18 00 00 00 48 48 48 48 4C 00 6F 00 63 00 61 00 6C 00 53 00 79 00 73 00 74 00 65 00 6D 00 00 00 00 00 00 00 48 48 48 48 00 48 48 48 48 48 48 48 00 48 48 48 48 48 48 48 05 00 00 00 48 48 48 48 0C 00 00 00 48 48 48 48 01 01 00 00 00 00 00 05 12 00 00 00 48 48 48 48 00 00 00 00 48 48 48 48 2C 00 00 00 48 48 48 48 00 00 00 00 FF FF FF FF 40 38 00 00 FF FF FF FF 07 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 48 48 48 48 FF FF 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 FF FF FF FF FF FF FF FF B4 00 00 00 FF FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00 00 7F 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 32 00 00 00
 51 00 75 00 65 00 75 00 65 00 52 00 65 00 70 00 6F 00 72 00 74 00 69 00 6E 00 67 00 42 00 6F 00 6F 00 74 00 54 00 72 00 69 00 67 00 67 00 65 00 72 00 48 48 66 66 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 FF FF FF FF FF FF FF FF 00 00 00 00 FF FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00 00 7F 00 00 01 FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00 30 00 00 00 51 00 75 00 65 00 75 00 65 00 52 00 65 00 70 00 6F 00 72 00 74 00 69 00 6E 00 67 00 57 00 6E 00 66 00 54 00 72 00 69 00 67 00 67 00 65 00 72 00 48 48 48 48 75 10 BC A3 3A 0B 94 41 01 00 00 00 00 00 00 00 01 66 66 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 FF FF FF FF FF FF FF FF 00 00 00 00 FF FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00 00 7F 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 40 00 00 00 51 00 75 00 65 00 75 00 65 00 52 00 65 00 70 00 6F 00 72 00 74 00 69 00 6E 00 67 00 46 00 72 00 65 00 65 00 4E 00 65 00 74 00 77 00 
6F 00 72 00 6B 00 54 00 72 00 69 00 67 00 67 00 65 00 72 00 48 48 48 48 75 10 BC A3 3E 0B 84 41 01 00 00 00 00 00 00 00 03 DD DD 00 00 00 00 00 00 00 07 07 00 00 00 06 00 80 53 4D AE 12 72 D7 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 08 07 00 00 00 00 00 00 FF FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00 00 01 43 B7 01 00 00 00 08 07 00 00 8D EC 00 00 32 00 00 00 51 00 75 00 65 00 75 00 65 00 52 00 65 00 70 00 6F 00 72 00 74 00 69 00 6E 00 67 00 54 00 69 00 6D 00 65 00 54 00 72 00 69 00 67 00 67 00 65 00 72 00 48 48
HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks\{D80AA3A2-189B-4A11-8828-511E6BAE5426}\DynamicInfo:  03 00 00 00 57 36 B7 DE 8E BA D3 01 51 E2 E2 57 0F 72 D7 01 00 00 00 00 00 00 00 00 F5 D7 1B 6B 0F 72 D7 01
HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks\{D80AA3A2-189B-4A11-8828-511E6BAE5426}\DynamicInfo:  03 00 00 00 57 36 B7 DE 8E BA D3 01 05 C1 08 9D 12 72 D7 01 00 00 00 00 00 00 00 00 65 7E A4 AC 12 72 D7 01
HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileService\References\S-1-5-21-1866265027-1870850910-1579135973-1000\RefCount:  06 00 00 00
HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileService\References\S-1-5-21-1866265027-1870850910-1579135973-1000\RefCount:  09 00 00 00

----------------------------------
Files added: 4
----------------------------------
C:\Users\REM\AppData\Roaming\Microsoft\Crypto\RSA\S-1-5-21-1866265027-1870850910-1579135973-1000\6e2dfb027d358203981ffcfbe886a86a_0ad3e319-280c-4f11-94d4-d3690a4931df
C:\Users\REM\AppData\Roaming\Microsoft\Protect\S-1-5-21-1866265027-1870850910-1579135973-1000\9b73d72d-285b-43bd-a1b8-9b2217e9c9d5
C:\Users\REM\AppData\Roaming\brbconfig.tmp
C:\Windows\Prefetch\BRBBOT.EXE-F9A274A7.pf

----------------------------------
Files deleted: 1
----------------------------------
C:\Users\REM\AppData\Local\Microsoft\Windows\Caches\{3DA71D5A-20CC-432F-A115-DFE92379E91F}.3.ver0x0000000000000029.db

----------------------------------
Files [attributes?] modified: 31
----------------------------------
C:\ProgramData\Microsoft\Windows\WER\ReportQueue\Critical_10.0.16299.15_3bbdd36d65ef6ae7f258edb4187df21a9f83d819_00000000_0dc896b2\Report.wer
C:\ProgramData\Microsoft\Windows\WER\ReportQueue\NonCritical_Update;_c0c3284d53dccf59f3f8aacdae31ecfbb18acf33_00000000_0208924f\Report.wer
C:\ProgramData\Microsoft\Windows\WER\ReportQueue\NonCritical_Update;_c0c3284d53dccf59f3f8aacdae31ecfbb18acf33_00000000_02f7108b\Report.wer
C:\ProgramData\Microsoft\Windows\WER\ReportQueue\NonCritical_Update;_c0c3284d53dccf59f3f8aacdae31ecfbb18acf33_00000000_03954903\Report.wer
C:\ProgramData\Microsoft\Windows\WER\ReportQueue\NonCritical_Update;_c0c3284d53dccf59f3f8aacdae31ecfbb18acf33_00000000_043ee15d\Report.wer
C:\ProgramData\Microsoft\Windows\WER\ReportQueue\NonCritical_Update;_c0c3284d53dccf59f3f8aacdae31ecfbb18acf33_00000000_0c15d77b\Report.wer
C:\ProgramData\Microsoft\Windows\WER\ReportQueue\NonCritical_Update;_c0c3284d53dccf59f3f8aacdae31ecfbb18acf33_00000000_0c93f599\Report.wer
C:\Users\All Users\Microsoft\Windows\WER\ReportQueue\Critical_10.0.16299.15_3bbdd36d65ef6ae7f258edb4187df21a9f83d819_00000000_0dc896b2\Report.wer
C:\Users\All Users\Microsoft\Windows\WER\ReportQueue\NonCritical_Update;_c0c3284d53dccf59f3f8aacdae31ecfbb18acf33_00000000_0208924f\Report.wer
C:\Users\All Users\Microsoft\Windows\WER\ReportQueue\NonCritical_Update;_c0c3284d53dccf59f3f8aacdae31ecfbb18acf33_00000000_02f7108b\Report.wer
C:\Users\All Users\Microsoft\Windows\WER\ReportQueue\NonCritical_Update;_c0c3284d53dccf59f3f8aacdae31ecfbb18acf33_00000000_03954903\Report.wer
C:\Users\All Users\Microsoft\Windows\WER\ReportQueue\NonCritical_Update;_c0c3284d53dccf59f3f8aacdae31ecfbb18acf33_00000000_043ee15d\Report.wer
C:\Users\All Users\Microsoft\Windows\WER\ReportQueue\NonCritical_Update;_c0c3284d53dccf59f3f8aacdae31ecfbb18acf33_00000000_0c15d77b\Report.wer
C:\Users\All Users\Microsoft\Windows\WER\ReportQueue\NonCritical_Update;_c0c3284d53dccf59f3f8aacdae31ecfbb18acf33_00000000_0c93f599\Report.wer
C:\Users\REM\AppData\Local\Microsoft\Windows\UsrClass.dat.LOG1
C:\Users\REM\AppData\Roaming\Microsoft\Protect\S-1-5-21-1866265027-1870850910-1579135973-1000\Preferred
C:\Users\REM\ntuser.dat.LOG2
C:\Windows\appcompat\Programs\Amcache.hve.LOG2
C:\Windows\Prefetch\CONSENT.EXE-65F6206D.pf
C:\Windows\Prefetch\DLLHOST.EXE-BB2E0C95.pf
C:\Windows\Prefetch\SEARCHFILTERHOST.EXE-AA7A1FDD.pf
C:\Windows\Prefetch\SEARCHPROTOCOLHOST.EXE-AFAD3EF9.pf
C:\Windows\Prefetch\SVCHOST.EXE-1F0766AF.pf
C:\Windows\Prefetch\SVCHOST.EXE-9984B1B8.pf
C:\Windows\Prefetch\SVCHOST.EXE-CB3F2FF8.pf
C:\Windows\ServiceProfiles\LocalService\NTUSER.DAT.LOG2
C:\Windows\ServiceProfiles\NetworkService\NTUSER.DAT.LOG2
C:\Windows\System32\config\DEFAULT.LOG1
C:\Windows\System32\config\SOFTWARE.LOG2
C:\Windows\System32\Tasks\Microsoft\Windows\Windows Error Reporting\QueueReporting
C:\Windows\System32\winevt\Logs\Microsoft-Windows-Crypto-DPAPI%4Operational.evtx

----------------------------------
Total changes: 56
----------------------------------

```

- `HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\brbbot: "C:\Users\REM\AppData\Roaming\brbbot.exe"`
  - This shows the sample uses the registry RUN key as persistence
- `C:\Users\REM\AppData\Roaming\brbconfig.tmp`
  - Creation of suspicious file in `%APPDATA%\brbconfig.tmp`

<br/>

Try inspecting `%APPDATA%\brbconfig.tmp` - it looks like a binary / encoded file:

![picture 30](../images/bb5c251f0f4541f6846ecb18d7016660ee220b8f07ef182937b62e0acef4a104.png)  


<br/>

Export the **Process Monitor** events as CSV:

![picture 16](../images/f5055bc78fcf4efff60dac3e14c7aff5d4f5f1e01b989ec49cb1d5a555edf04e.png)  

![picture 17](../images/b3b483359ff2c2450357b30916fc3cfbed99b2be48c61c336423b5d1a2d3cbda.png)  

<br/>

---

## 8 - Analyze Process Monitor's log file using ProcDOT

![picture 18](../images/22560c09d4d16f23ce96e8c1a530016747347188b2f0de44ba48a883b67fabbe.png)  

![picture 19](../images/31d1e9bd30e8ea86d49d26989f7e9a634a130965ce5491639458e72782a6b4e1.png)  

- First the instance of `brbbot.exe` creates the 1st thread to:
  - Create AUTOSTART key
  - Create PENDINGFILERENAMEOPERATIONS
  - Create `%APPDATA%\Roaming\brbconfig.tmp`
  - Then kill its own

- It also has another thread:
  - Set `HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\ProxyBypass` to `1`
  - Set `HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\IntranetName` to `1`
  - Set `HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\UNCAsIntranet` to `1`
  - Set `HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\AutoDetec` to `0`
  - It also query back the above registry keys

<br/>

---

## 9 - Examine Wireshark events

![picture 20](../images/8346dbdab85a73b42b16eaf4901944978ec572550e79979d078e2b6893d3f9d2.png)  

- The infected host is querying `brb.3dtuts.by`

<br/>

---

## References

![picture 31](../images/1ed20af12080aadd87bbc1d3fe9fa15fe010dd5ae9f064473819ba966fdd79f6.png)  
