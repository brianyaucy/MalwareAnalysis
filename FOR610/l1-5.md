# Ex 1.5: Experimenting with C2 Functionality in brbbot.exe

- [Ex 1.5: Experimenting with C2 Functionality in brbbot.exe](#ex-15-experimenting-with-c2-functionality-in-brbbotexe)
  - [Objectives](#objectives)
  - [Steps](#steps)
  - [1,2 - Issue the cexe C2 command](#12---issue-the-cexe-c2-command)
  - [3 - Issue the tixe C2 command](#3---issue-the-tixe-c2-command)

---

## Objectives

- Learn how to examine C2 capabilities of malware through behavioral experiments.

<br/>

---

## Steps

1. Create the `ads.php` file on **REMnux** to issue the `cexe` C2 command to `brbbot.exe`.
2. Reinfect the system and examine the web server's C2 command on `brbbot.exe`.
3. Create the `ads.php` file on **REMnux** to issue the `tixe` C2 command to `brbbot.exe`.

<br/>

---

## 1,2 - Issue the cexe C2 command

Following up the previous logs on Wireshark, our web server on **REMnux** respond with `400` since we do not have `ads.php`.

![picture 48](../images/3226e5ed7c4f793266fc66bce55e0df306128abfbb11de1a6aec017aa32304a0.png)  

<br/>

Also, when decrypting the `brbconfig.tmp` folder, we have some potential C2 commands:

```
uri=ads.php;exec=cexe;file=elif;conf=fnoc;exit=tixe;encode=5b;sleep=30000
```

- `exec=cexe; file=elif; conf=fnoc; exit=tixe`: These look like command set. The value is in reverse order - could be an evasion.


<br/>

Try to host a `ads.php` with a C2 command:

```
echo 'cexe "C:\Windows\notepad.exe"' > ads.php
sudo python -m SimpleHTTPServer 80
```

![picture 49](../images/8c6ed561b86f2711630feb28fe3207b988d40b0a21fed3d3c136a6ed7fc5c0e9.png)  

<br/>

On **REMnux**, restart **Wireshark** and start capturing.

Then on the Windows machine, try running `brbbot.exe` again:

![picture 51](../images/e3da7de2d8b9c85dbeac25111fbc560dcbec01842172299b79d1534dcdd6ccfb.png)  

![picture 50](../images/649d3d8cde8e93db44af1d160895aaa00eb343639e78289c104965e039c65892.png)  

- As shown on the **Wireshark** capture, our server respond the potential C2 command `cexe "C:\Windows\notepad.exe"`
- As shown on Windows machine, `notepad.exe` is executed as a child process of `brbbot.exe` (See **Process Hacker**)

<br/>

Terminate the `brbbot.exe` process on **Process Hacker** or it will keep spawning `notepad.exe` ...

<br/>

---

## 3 - Issue the tixe C2 command

The `tixe` command is suspected to be `exit` - it is expected that if the sample receives this respond, it will terminate itself.

<br/>

Prepare the `ads.php` with the following content in the **REMnux** webserver:

```
rm ads.php -f
echo "tixe" > ads.php
sudo python -m SimpleHTTPServer 80
```

![picture 52](../images/19257f067b9c2cdf4091f267340b41217410ca20d42b252f4671009cedf51b36.png)  

<br/>

Then restart **Wireshark** and start a new capture session.

Reinfect the Windows machine:

![picture 54](../images/6ec2f07d4218269479f5249ca098170e093053f3aa2b0f6e42ec9b515966f1cd.png)  

![picture 53](../images/6eedf1deffae2f6dafa4948b40c3c71ed57bd82e563a25e21f227a46e16bb112.png)  

- As a result, the `brbbot.exe` exits itself after making the HTTP request
- On **Procmon**, it shows the process exits.

<br/>

---